buildscript {
    repositories {
        jcenter()
    }

    dependencies {
        classpath 'de.undercouch:gradle-download-task:5.1.0'
    }
}

apply plugin: 'de.undercouch.download'
apply plugin: 'java'

group 'com.irtimaled'
version project.buildVersion + '-' + project.mcVersion
archivesBaseName = 'BBOutlineReloaded'

sourceCompatibility = 1.17
targetCompatibility = 1.17

compileJava {
    // dependsOn 'downloadServer'
}

repositories {
    mavenCentral()
    maven {
        url = 'https://papermc.io/repo/repository/maven-releases/'
    }
    maven {
        url "https://libraries.minecraft.net"
    }
}

dependencies {
    // compileOnly files("run/craftbukkit-${mcVersion}-R0.1-SNAPSHOT.jar")
    compileOnly fileTree(dir: 'lib', includes: ['*.jar'])
}

sourceSets {
    main
}

jar {
    destinationDir = new File('run/plugins')

    manifest {
        attributes([
                "Main-Class": "com.irtimaled.bbor.Main",
                "Specification-Title": "bbor",
                "Specification-Vendor": "Irtimaled",
                "Specification-Version": "1", // We are version 1 of ourselves
                "Implementation-Title": project.name,
                "Implementation-Version": "${version}",
                "Implementation-Vendor": "Irtimaled",
                "Implementation-Timestamp": new Date().format("yyyy-MM-dd'T'HH:mm:ssZ")
        ])
    }

    classifier = 'bukkit'
}

processResources {
    filesMatching('plugin.yml') {
        expand([
                'version': project.version
        ])
    }
}

artifacts {
    archives jar
}

/*
task downloadServer(type: Download) {
    src "https://download.getbukkit.org/craftbukkit/craftbukkit-${mcVersion}.jar"
    dest new File("run/craftbukkit-${mcVersion}.jar")
    overwrite false
}
 */

task runServer(dependsOn: jar, type: JavaExec) {
    workingDir = new File('run');

    main = "-jar";
    args = [
            "craftbukkit-${mcVersion}.jar",
            "--nogui"
    ]
}
